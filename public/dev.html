<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Aurion v1 â€” Dev Console</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body { font-family: system-ui, sans-serif; max-width: 960px; margin: 20px auto; padding: 0 12px; }
  textarea { width: 100%; min-height: 180px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
  button { padding: 8px 14px; border: 0; background: #0a7; color: #fff; border-radius: 8px; margin-top: 8px; }
  section { margin: 24px 0; padding: 16px; border: 1px solid #ddd; border-radius: 12px; }
  h2 { margin: 0 0 10px; }
  label { display:block; margin:8px 0; }
  .warn { color:#a00; }
  .ok { color:#0a7; }
</style>
</head>
<body>
<h1>ðŸ”¥ Aurion Developer Console</h1>

<section>
  <h2>Core memories</h2>
  <p>One memory per line:</p>
  <textarea id="core"></textarea>
  <div>
    <button id="save">Save core</button>
    <span id="coreMsg"></span>
  </div>
</section>

<section>
  <h2>Self-patch (with backup)</h2>
  <p class="warn">Danger zone: this replaces a file. The current file is backed up first.</p>
  <label>Target file (relative to project root): <input id="target" value="server.js"/></label>
  <p>Paste FULL new file contents here:</p>
  <textarea id="patch"></textarea>
  <div>
    <button id="propose">Propose</button>
    <button id="apply">Apply</button>
    <span id="patchMsg"></span>
  </div>
</section>

<script>
async function loadCore(){
  const r = await fetch('/core'); const j = await r.json();
  document.getElementById('core').value = (j.core||[]).join('\n');
}
loadCore();

document.getElementById('save').onclick = async () => {
  const lines = document.getElementById('core').value.split(/\r?\n/).filter(Boolean);
  const r = await fetch('/core', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ core: lines }) });
  const j = await r.json();
  document.getElementById('coreMsg').textContent = j.ok ? 'Saved âœ“' : ('Error: '+(j.error||''));
  document.getElementById('coreMsg').className = j.ok ? 'ok' : 'warn';
};

document.getElementById('propose').onclick = async () => {
  const patch = document.getElementById('patch').value;
  const r = await fetch('/dev/propose', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ patch }) });
  const j = await r.json();
  document.getElementById('patchMsg').textContent = j.ok ? 'Looks valid. Ready to apply.' : ('Error: '+(j.error||''));
  document.getElementById('patchMsg').className = j.ok ? 'ok' : 'warn';
};

document.getElementById('apply').onclick = async () => {
  const patch = document.getElementById('patch').value;
  const target = document.getElementById('target').value;
  const r = await fetch('/dev/apply', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ patch, target }) });
  const j = await r.json();
  document.getElementById('patchMsg').textContent = j.ok ? ('Applied âœ“ â€” backup: '+j.backup) : ('Error: '+(j.error||''));
  document.getElementById('patchMsg').className = j.ok ? 'ok' : 'warn';
};
</script>
</body>
</html>
