<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aurion Developer Console</title>
<style>
body {
  font-family: sans-serif;
  max-width: 900px;
  margin: 0 auto;
  padding: 1rem;
  line-height: 1.4;
}
section {
  margin-bottom: 2rem;
}
textarea {
  width: 100%;
  min-height: 200px;
  font-family: monospace;
  margin-top: 0.5rem;
}
button {
  padding: 0.5rem 1rem;
  margin-top: 0.5rem;
}
label {
  display: block;
  margin-top: 0.5rem;
}
</style>
</head>
<body>
<h1>Aurion Developer Console</h1>

<section>
  <h2>Core Memory</h2>
  <p>Edit Aurionâ€™s core memories (one per line) and save.</p>
  <textarea id="coreArea"></textarea>
  <button id="saveCore">Save Core</button>
  <p id="coreStatus"></p>
</section>

<section>
  <h2>Patch & Update Code</h2>
  <p>Paste the full contents of the file you wish to replace (e.g., <code>server.js</code>). On apply, the existing file will be backed up and replaced by your patch.</p>
  <label>
    Target file:
    <select id="target">
      <option value="server.js">server.js</option>
    </select>
  </label>
  <textarea id="patchArea"></textarea>
  <button id="propose">Propose Patch</button>
  <button id="apply">Apply Patch</button>
  <p id="patchStatus"></p>
</section>

<script>
// Load current core memories
async function loadCore() {
  const res = await fetch('/core');
  const data = await res.json();
  document.getElementById('coreArea').value = (data.core || []).join('\n');
}
loadCore();

document.getElementById('saveCore').onclick = async () => {
  const lines = document.getElementById('coreArea').value.split(/\r?\n/).filter(Boolean);
  const res = await fetch('/core', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ core: lines })
  });
  const data = await res.json();
  document.getElementById('coreStatus').textContent = data.ok ? 'Core saved!' : 'Error saving core';
};

document.getElementById('propose').onclick = async () => {
  const patch = document.getElementById('patchArea').value;
  const res = await fetch('/dev/propose', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ patch })
  });
  const data = await res.json();
  document.getElementById('patchStatus').textContent =
    data.ok ? 'Patch looks valid. Ready to apply.' : `Error: ${data.error}`;
};

document.getElementById('apply').onclick = async () => {
  const patch = document.getElementById('patchArea').value;
  const target = document.getElementById('target').value;
  const res = await fetch('/dev/apply', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ patch, target })
  });
  const data = await res.json();
  if (data.ok) {
    document.getElementById('patchStatus').textContent =
      `Patch applied. Backup created: ${data.backup}`;
  } else {
    document.getElementById('patchStatus').textContent =
      `Error applying patch: ${data.error}`;
  }
};
</script>
</body>
</html>
