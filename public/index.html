<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aurion v1 — Chat</title>
<style>
body {
  background: #0b0d17;
  color: #f5f5f5;
  font-family: sans-serif;
  margin: 0;
  padding: 0;
}
#chat {
  max-width: 800px;
  margin: 0 auto;
  padding: 1rem;
  overflow-y: auto;
  height: calc(100vh - 220px);
}
.message {
  margin: 0.5rem 0;
  padding: 0.6rem 1rem;
  border-radius: 8px;
  white-space: pre-wrap;
}
.message.user {
  background: #1f2632;
  text-align: right;
}
.message.assistant {
  background: #151a24;
}
#input-container {
  max-width: 800px;
  margin: 0 auto;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}
textarea {
  width: 100%;
  min-height: 60px;
  resize: vertical;
  padding: 0.6rem;
  font-size: 1rem;
  border: 1px solid #444;
  border-radius: 6px;
  background: #1f2632;
  color: #f5f5f5;
}
button {
  padding: 0.6rem 1rem;
  font-size: 1rem;
  background: #ff8c00;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  color: #fff;
}
button:disabled {
  opacity: 0.5;
}
label {
  font-size: 0.9rem;
}
#waiting {
  font-style: italic;
  color: #888;
}
</style>
</head>
<body>
<div id="chat"></div>
<div id="input-container">
  <textarea id="message" placeholder="Speak to the forge…"></textarea>
  <div style="display:flex; gap:0.5rem; align-items:center;">
    <button id="send">Send</button>
    <label><input type="checkbox" id="includeCore"> Include core memories</label>
  </div>
  <div id="waiting"></div>
</div>

<script>
(function() {
  const chatEl = document.getElementById('chat');
  const msgEl = document.getElementById('message');
  const sendBtn = document.getElementById('send');
  const waitingEl = document.getElementById('waiting');
  const includeCoreEl = document.getElementById('includeCore');

  // Generate or load a unique user ID to keep per‑user memory
  let userId = localStorage.getItem('aurionUserId');
  if (!userId) {
    userId = Math.random().toString(36).slice(2);
    localStorage.setItem('aurionUserId', userId);
  }

  function addMessage(role, text) {
    const div = document.createElement('div');
    div.className = `message ${role}`;
    div.textContent = text;
    chatEl.appendChild(div);
    chatEl.scrollTop = chatEl.scrollHeight;
  }

  async function sendMessage() {
    const text = msgEl.value.trim();
    if (!text) return;

    addMessage('user', text);
    msgEl.value = '';
    waitingEl.textContent = 'Aurion is thinking…';

    try {
      const res = await fetch('/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          message: text,
          u: userId,
          core: includeCoreEl.checked
        })
      });
      const data = await res.json();
      if (data.reply) {
        addMessage('assistant', data.reply);
      } else if (data.error) {
        addMessage('assistant', `Error: ${data.error}`);
      }
    } catch (err) {
      addMessage('assistant', `Error: ${err.message}`);
    } finally {
      waitingEl.textContent = '';
    }
  }

  sendBtn.addEventListener('click', sendMessage);
  msgEl.addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });
})();
</script>
</body>
</html>
